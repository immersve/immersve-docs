[{"title":"Getting Started","type":0,"sectionRef":"#","url":"","content":"Getting Started Immersve is a multi chain payment protocol and Web3 / Metaverse Mastercard product. Powered by the tech and values of web3, Immersve enables its clients to deliver a decentralized payment experience.","keywords":""},{"title":"Authentication","type":0,"sectionRef":"#","url":"api-reference/authentication","content":"Authentication üìÑÔ∏è Generate Challenge Generating the challenge is the first step in the process of getting the authentication token üìÑÔ∏è Login The login endpoint returns the authentication token in exchange for the previously issued challenge signed with the users wallet","keywords":""},{"title":"Cards","type":0,"sectionRef":"#","url":"api-reference/card","content":"Cards üìÑÔ∏è Order a card Order a virtual credit card for the current user üìÑÔ∏è Cancel card Cancel the card üìÑÔ∏è Generate card PAN token Generate a token to get the card's detail (full pan and cvv2) üìÑÔ∏è Get prerequisite transactions This endpoint returns web3 transactions required to authorize the creation of a new Immersve Card. It is also intended for integrating clients to check that everything is in place before making the actual web3 transactions. Among such things are KYC and AML checks. These are early checks before creating the card to prevent end-users unnecessarily paying for the gas fees of two transactions, should any of the checks fail.","keywords":""},{"title":"Currency","type":0,"sectionRef":"#","url":"api-reference/currency","content":"Currency üìÑÔ∏è Currency List Get the list of supported currencies by Immersve üìÑÔ∏è Currency Convert Convert a source currency to a target currency using Mastercard rates","keywords":""},{"title":"Authentication","type":0,"sectionRef":"#","url":"guides/authentication","content":"Authentication API calls can be authenticated by providing a user access token in the ‚ÄúAuthorization‚Äù header. Immersve uses EIP-4361 for the sign-in process. The following sections describe the process in detail Login Flow‚Äã Request EIP-4361 challenge. The response is a EIP-4361 message to be signed by the wallet in plain text, for example: app.immersve.com wants you to sign in with your Ethereum account: 0xA3058369d6A481B1ff08F62B352409c3D709De9b Sign in with Ethereum to the app. This request will not trigger a blockchain transaction or cost any gas fees. URI: https://app.immersve.com Version: 1 Chain ID: 1 Nonce: 2hFm7TDbZmerUgnrJ Issued At: 2022-08-11T22:29:48.244Z Invoke the wallet's signing capability to get a signature for the challenge message. This part's implementation is specific to the wallet used, but it is fair to say that this abstract function is available in all wallets. Submit the signed challenge with its signature to get the authentication token The received token should be used for consequent requests to protected resources in the Authorization header","keywords":""},{"title":"Card","type":0,"sectionRef":"#","url":"guides/card","content":"Card Card State‚Äã After created, the card is activated. when the card is used or canceled by user, it will go to the cancelled state. Card Usage‚Äã Before create a card, users need to transfer USDC from their wallet address to Immersve wallet address. Then they create a card associate with the transaction. Immersve will locked the funds of the transaction in the card for further spending. For security sake, the returned card only include truncated pan and expiry. To get the full pan and cvv2, users need to: generate one-time use card PAN token from Immersve using this APIuse the token to get the card's details from E6 mobile API Example response payload: { &quot;creationTime&quot;: 1663888904887, &quot;modifiedTime&quot;: 1663888904887, &quot;id&quot;: &quot;1F63FE470D29ABC5C727570C1AD42B82-1000041003&quot;, &quot;cardNumber&quot;: &quot;5713851215688026472&quot;, &quot;panFirst6&quot;: &quot;424211&quot;, &quot;panLast4&quot;: &quot;0528&quot;, &quot;type&quot;: &quot;virtual&quot;, &quot;state&quot;: &quot;activated&quot;, &quot;sequenceNumber&quot;: 1, &quot;cardProfileName&quot;: &quot;Test card&quot;, &quot;pinFailCount&quot;: 0, &quot;reissue&quot;: false, &quot;expiry&quot;: &quot;202409&quot;, &quot;customerNumber&quot;: &quot;10000021250574&quot;, &quot;embossedName&quot;: &quot;CARDHOLDER/IMMERSVE&quot;, &quot;programName&quot;: &quot;vcc&quot;, &quot;pan&quot;: &quot;&lt;the full pan of the card&gt;&quot;, &quot;cvv2&quot;: &quot;&lt;the cvv2 of the card&gt;&quot; } If users authorize a merchant to use the card, credit network will send authorization and clearing request to Immersve, if the transaction are cleared. the card will be cancelled by Immersve automatically.If users change their mind before the card is used, they can cancel the card by calling cancel card API. ","keywords":""},{"title":"Immersve Payment Gateway","type":0,"sectionRef":"#","url":"contracts/payment-gateway","content":"Immersve Payment Gateway Contract Module that allows CardHolders to deposit funds and lock them to be able to use them with one time use Immersve Credit Cards. Extensions‚Äã For security reasons, the smart contract implements the following OpenZeppelin Contracts InitializableAccessControlPausableReentrancyGuard Proxy‚Äã The Smart Contract implements the OpenZeppelin TransparentUpgradeable proxy. Proxy features: Security: If any bugs are found, or potential security risks, the Smart Contract can be updated to resolve any potential issuesFeature Upgradeability: Any new features and bug fixes can be added. The Smart Contract will keep the same state, without the need of expensive migrationsStability: Clients interacting with the Smart Contract will always do so through the same proxy address. The proxy will know the current implementation address and will always keep the same state. More about upgradeable contracts here: https://blog.openzeppelin.com/the-state-of-smart-contract-upgrades/ Functions‚Äã initialize(address payable _settlementAddress, address _usdcSmartContract, uint256 _defaultTimeoutBlocks, uint256 _safetyBlocks) external initializer‚Äã Initialize the Smart Contract with the required arguments _settlementAddress (type address payable): The web3 address were Locked funds will be sent once a payment is confirmed by Immersve_usdcSmartContract (type address): The current network address of the ERC-20 USDC Smart Contract_defaultTimeoutBlocks (type uin256): Number of blocks in the blockchain that an asset lock will last by default_safetyBlocks (type uin256): Number of blocks on top of the default timeout used to calculate if a Lock is usable or not. Because there might be a delay between a transaction confirmation and the actual use of Locked funds by Immersve, there has to be some safety threshold for Immersve to execute the settlement of funds. getVersion() external pure returns(string memory)‚Äã Get the current version implementation of the smart contract with a Version number stored in a Solidity Constant. This means that the constant is not saved into the Smart Contract store. pause() public onlyRole(PAUSER_ROLE)‚Äã Pauses the functionality of the Smart Contract. All the functions marked with the whenNotPaused modifier will reject the transaction once a pause is in effect. Only the PAUSER_ROLE will be able to call this function. unpause() public onlyRole(PAUSER_ROLE)‚Äã Unpauses the functionality of the Smart Contract. All the functions marked with the whenNotPaused modifier will accept the transaction normally. Only the PAUSER_ROLE will be able to call this function. setTimeoutBlocks(uint256 timeoutBlocks) public onlyRole(SETTLER_ROLE)‚Äã Set the default timeout for AssetLockedFund as described in Asset Locked Funds section. Only the SETTLER_ROLE will be able to call this function. timeoutBlocks (type uin256): Number of blocks for an Asset Lock to be considered expired setSafetyBlocks(uint256 timeoutBlocks) public onlyRole(SETTLER_ROLE)‚Äã Set the safety block threshold for AssetLockedFund as described in Asset Locked Funds section. Only the SETTLER_ROLE will be able to call this function. timeoutBlocks (type uin256): Number of blocks for an Asset Lock to be considered safe to settle deposit(uint256 usdcAmount) external whenNotPaused nonReentrant‚Äã CardHolders can deposit USDC funds into the Smart Contract using this function. The funds can either be locked or withdrawn by the consumer later. Locked funds cannot be withdrawn until the lock expires, or the user revokes the lock with an Immersve token. There is a pre-requisite for this function to work. Because USDC is an ERC-20 token, the consumer needs to approve (https://polygonscan.com/token/0x2791bca1f2de4661ed88a30c99a7a9449aa84174#writeProxyContract#F1 USDC funds to the Smart Contract public address usdcAmount (type uin256): USDC Amount to deposit in ethers format depositTo(uint256 usdcAmount, address sender) external whenNotPaused nonReentrant‚Äã CardHolders can deposit USDC funds for a specific address into the Smart Contract using this function. The funds can either be locked or withdrawn by the consumer later. Locked funds cannot be withdrawn until the lock expires, or the user revokes the lock with an Immersve token. There is a pre-requisite for this function to work. Because USDC is an ERC-20 token, the consumer needs to approve (https://polygonscan.com/token/0x2791bca1f2de4661ed88a30c99a7a9449aa84174#writeProxyContract#F1 USDC funds to the target sender address for the Smart Contract public address usdcAmount (type uin256): USDC Amount to deposit in ethers formataddress (type address): Deposit target address withdraw(uint256 usdcAmount) external whenNotPaused nonReentrant‚Äã CardHolders can withdraw USDC funds associated to their balance from the Smart Contract using this function. Locked funds cannot be withdrawn until the lock expires, or the user revokes the lock with an Immersve token. usdcAmount (type uin256): USDC Amount to withdraw in ethers format createLockedFund (uint256 usdcAmount) external whenNotPaused nonReentrant‚Äã CardHolders can put a Lock in place for deposited funds so Immersve can authorize the use of a credit card using those locked funds as collateral. The locked funds will be represented with a AssetLockedFund struct inside the Smart Contract. When created, a timeout will be put in place for this lock based on the default Timeout Blocks (see []) usdcAmount (type uin256): USDC Amount to lock in ethers format depositAndCreateLockedFund (uint256 usdcAmount) external whenNotPaused nonReentrant‚Äã Similar to deposit but combined with createLockedFund. This function is doing both the deposit and the lock at the same time to save gas fees. usdcAmount (type uin256): USDC Amount to deposit in ethers format depositAndCreateLockedFundFor (uint256 usdcAmount, address sender) external whenNotPaused nonReentrant‚Äã Similar to depositAndCreateLockedFund but the target address is specified as an argument instead of using msg.sender usdcAmount (type uin256): USDC Amount to deposit in ethers format confirmLockedFundPayment (address sender, uint256 price, uint256 lockedFundId) external whenNotPaused nonReentrant onlyRole(SETTLER_ROLE)‚Äã Used by Immersve to confirm the settlement of an Immersve Card payment. This function will check that the specified address has enough locked funds for the specified lockedFundId and will transfer the settlement amount (price) to the settlement address, specified in the initialize function. It can only be called by the SETTLER role sender (type address): CardHolder Address doing a payment requiring locked funds with Immersveprice (type uin256): USDC Amount to settle in ethers formatlockedFundId (type uin256): Matching Locked Fund Id (which is linked to a Card) to settle payment being done with an Immersve Credit Card getAvailableLockedFundsBalance (address sender)‚Äã Get Available Locked funds for the specified address sender (type address): CardHolder Address that already did a funds lock getBalance()‚Äã Get the available USDC balance of the msg.sender deposited in the Smart Contract. Balance is not the necessarily the same as locked funds as the former are short lived. getSenderBalance (address sender)‚Äã Get the available USDC balance of the specified sender argument, deposited in the Smart Contract. Balance is not the necessarily the same as locked funds as the former are short lived. sender (type address): CardHolder Address getLockedFunds()‚Äã Get the AssetLockedFund objects of the msg.sender getSenderLockedFunds (address sender) onlyRole(SETTLER_ROLE)‚Äã Get the AssetLockedFund objects of the specified sender argument sender (type address): CardHolder Address that already locked funds at least once revokeLockedFundMultiSig (uint256 lockedFundId, uint256 nonce, bytes memory signature) external whenNotPaused nonReentrant‚Äã CardHolders will be able to revoke a fund lock using an Immersve signature. Immersve will first check if the funds is being used for a payment on Immersve backend. If the funds are free to release, Immersve will sign a message with a nonce only valid for a lockedFundId and the funds will be put back into the CardHolder balance lockedFundId (type uint256): Id of the AssetLockedFund to be releasednonce (type uint256): Nonce provided by Immersve API and matches the signaturesignature (type memory): String signature provided by Immersve API created with a nonce to avoid replay calls revokeLockedFund (address sender, uint256 lockedFundId) external whenNotPaused nonReentrant onlyRole(SETTLER_ROLE)‚Äã Function used by Immersve Backend (only SETTLER role can call this function) to revoke an unexpired lock. This could be done if Immersve detect illegal or malicious activity related to the sender and prefers to revoke locked fund ids sender (type address): CardHolder Address that already locked funds with the Smart ContractlockedFundId (type uint256): Id of the AssetLockedFund to be released Immersve Card E-Commerce Payment Happy Path‚Äã Card Holder locks USDC funds with Immersve Smart ContractCard Holder receives a valid Credit Card to be used for E-Commerce transaction from ImmersveCard Holder uses the Immersve Card to pay for goods purchased on an E-Commerce platformImmersve authorizes the payment with Credit Card network once the locked funds are confirmedPurchase is confirmed by Immersve and E-Commerce merchant","keywords":""}]