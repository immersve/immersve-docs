---
const { group, pathname } = Astro.props;
let [sections, visibleSections] = useInitialValue(
  [
    useSectionStore((s) => s.sections),
    useSectionStore((s) => s.visibleSections),
  ],
  useIsInsideMobileNavigation(),
)

let isPresent = useIsPresent()
let firstVisibleSectionIndex = Math.max(
  0,
  [{ id: '_top' }, ...sections].findIndex(
    (section) => section.id === visibleSections[0],
  ),
)
let itemHeight = remToPx(2)
let height = isPresent
  ? Math.max(1, visibleSections.length) * itemHeight
  : itemHeight
let top =
  group.links.findIndex((link) => link.href === pathname) * itemHeight +
  firstVisibleSectionIndex * itemHeight

---
<motion.div
  layout
  initial={{ opacity: 0 }}
  animate={{ opacity: 1, transition: { delay: 0.2 } }}
  exit={{ opacity: 0 }}
  className="absolute inset-x-0 top-0 bg-zinc-800/2.5 will-change-transform dark:bg-white/2.5"
  style={{ borderRadius: 8, height, top }}
/>
