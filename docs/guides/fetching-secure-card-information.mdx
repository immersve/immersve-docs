import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Fetching secure card information

In order to retrieve the secure details of a card (cvv, expiry, pan), a one-time token must be generated.

The steps for retrieving secure card details is as follows:

1. Call the [Get a card token](/api-reference/get-a-card-token) endpoint with the card id. This endpoint accepts both custodial and non-custodial authentication.
2. Call the [Get secure card details](/api-reference/get-secure-card-details) endpoint with the returned `tokenId` as a query parameter. The `tokenId` can only be used a single time and once used, subsequent calls to this endpoint with the same token will return a `403` response code.

# Example code snippet

<Tabs>
<TabItem value="js" label="JavaScript">

```js
import axios from 'axios';

// Using non-custodial authentication
const tokenResponse = await axios.post(
  'https://api.immersve.com/api/cards/123/pan-token',
  {},
  {
    headers: {
      Authorization: 'Bearer eyJhbvbbfg', // jwt token,
    },
  }
);

const secureCardDetail = await axios.get(
  'https://api-sec.immersve.com/api/cards/secure',
  {
    params: {
      tokenId: tokenResponse.data.tokenId,
    },
  }
);

// Using custodial authentication
const tokenResponse = await axios.post(
  'https://api.immersve.com/api/cards/123/pan-token',
  {},
  {
    headers: {
      'x-api-key': 'imm-key-prod-LIVE-6e7e3821983ef6fe6cecabdbc8571bbf',
      'x-api-secret': 'imm-secret-prod-LIVE-95b90292dfd747c143a9d258a93fb835',
      'x-account-id': '8gh464292dfd747c143a9d258aj6jdkd8', // target account id (the account id this card belongs to)
    },
  }
);

const secureCardDetail = await axios.get(
  'https://api-sec.immersve.com/api/cards/secure',
  {
    params: {
      tokenId: tokenResponse.data.tokenId,
    },
  }
);
```

</TabItem>
</Tabs>
