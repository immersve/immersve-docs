post:
  tags:
    - card
    - prerequisites
  summary: Get prerequisites
  description: |
    This endpoint returns the requisite blockchain transactions required to permit the action (ex. creation of a new Immersve Card). It also indicates if everything is in order before instructing the client of any blockchain transactions. Insufficient KYC and AML status may trigger an error response.
  parameters:
    - in: path
      name: action
      required: true
      schema:
        type: string
        enum: [create-card, withdraw]
    - name: useMinorUnits
      in: query
      description: When enabled, amount in request body must be in minor units, an integer in the smallest denomination for the given currency. 
      required: false
      schema:
        type: boolean

  requestBody:
    content:
      application/json:
        schema:
          $ref: '../cards/models/get-prerequisite-transactions-request.yaml'
    required: true
  responses:
    '200':
      description: |
        User is allowed to perform action. Client should be able to request transactions from the user wallet to Immersve wallet
        The client needs to parse transaction info and convert it to the chain-specific calls
      content:
        application/json:
          schema:
            $ref: '../cards/models/get-prerequisite-transactions-response.yaml'
          example: |
            {
              "requiredTransactions": [
                {
                  "type": "smart_contract_write",
                  "params": {
                    "abi": [
                      {
                        "constant": false,
                        "inputs": [
                          {
                            "name": "_spender",
                            "type": "address"
                          },
                          {
                            "name": "_value",
                            "type": "uint256"
                          }
                        ],
                        "name": "approve",
                        "outputs": [
                          {
                            "name": "",
                            "type": "bool"
                          }
                        ],
                        "payable": false,
                        "stateMutability": "nonpayable",
                        "type": "function"
                      }
                    ],
                    "contractAddress": "0x5FbDB2315678afecb367f032d93F642f64180aa3",
                    "method": "approve",
                    "params": {
                      "_spender": "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512",
                      "_value": "1000000"
                    }
                  }
                },
                {
                  "type": "smart_contract_write",
                  "params": {
                    "abi": [
                      {
                        "inputs": [
                          {
                            "internalType": "uint256",
                            "name": "_amount",
                            "type": "uint256"
                          }
                        ],
                        "name": "depositAndLock",
                        "outputs": [],
                        "stateMutability": "nonpayable",
                        "type": "function"
                      }
                    ],
                    "contractAddress": "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512",
                    "method": "depositAndLock",
                    "params": {
                      "_amount": "1000000"
                    }
                  }
                }
              ]
            }
    '403':
      description: |
        User is not allowed to get the deposit details with the reason stated in the `message`

        **KYC_REQUIRED** 
        User is required to perform KYC because they are about to spend the amount that exceeds the KYC-free limit.
        Immersve requires them to provide identification information to comply with regulatory requirements

        **AML_REQUIRED**
        User is not allowed to create a card due to AML Checks Failing
        Immersve AML Provider found that the funding wallet might not comply with AML and canâ€™t check the origin of funds for the provided wallet. User will need to go through AML process to validate the source of the funds on the wallet

        **AML_PERMANENTLY_FAILED**
        Similar to AML_REQUIRED, except the user can not remediate the failing check, because the intended deposit wallet is permanently blacklisted.
      content:
        application/json:
          schema:
            $ref: '../../models/api-error.yaml'
