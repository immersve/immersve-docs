"use strict";(self.webpackChunkimmersve_docs=self.webpackChunkimmersve_docs||[]).push([[4762],{67457:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var a=n(87462),i=(n(67294),n(3905)),s=n(8209);const r={sidebar_position:2,tags:["authentication","non-custodial","custodial","sign-in","sign-up","login"]},l="Authentication",o={unversionedId:"guides/authentication",id:"guides/authentication",title:"Authentication",description:"Depending on the use case and operation, either API key or Sign-in-with-ethereum (SIWE) authentication mechanism may be used.",source:"@site/docs/guides/authentication.md",sourceDirName:"guides",slug:"/guides/authentication",permalink:"/guides/authentication",draft:!1,tags:[{label:"authentication",permalink:"/tags/authentication"},{label:"non-custodial",permalink:"/tags/non-custodial"},{label:"custodial",permalink:"/tags/custodial"},{label:"sign-in",permalink:"/tags/sign-in"},{label:"sign-up",permalink:"/tags/sign-up"},{label:"login",permalink:"/tags/login"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,tags:["authentication","non-custodial","custodial","sign-in","sign-up","login"]},sidebar:"primarySidebar",previous:{title:"Getting Started",permalink:"/"},next:{title:"Card Lifecycle",permalink:"/guides/card-lifecycle"}},c={},u=[{value:"API Key Authentication",id:"api-key-authentication",level:2},{value:"SIWE Authentication",id:"siwe-authentication",level:2},{value:"Login Flow",id:"login-flow",level:3}],p={toc:u};function h(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"authentication"},"Authentication"),(0,i.kt)("p",null,"Depending on the use case and operation, either API key or Sign-in-with-ethereum (SIWE) authentication mechanism may be used."),(0,i.kt)("p",null,"The SIWE method allows client applications to act on behalf of users within scopes explicitly granted by the user and is typically used by ",(0,i.kt)("a",{parentName:"p",href:"/guides/non-custodial-wallets"},"decentralized applications and web3 wallets"),". API keys might be used for administrative operations and for applications not using SIWE authentication for their users such as ",(0,i.kt)("a",{parentName:"p",href:"/guides/custodial-wallets"},"custodial wallets and exchanges"),"."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://immersve.com/contact/"},"Contact us")," to provision credentials for your application."),(0,i.kt)("h2",{id:"api-key-authentication"},"API Key Authentication"),(0,i.kt)("p",null,"Each request must be made with the following headers:"),(0,i.kt)("p",null,"Authentication:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"x-api-key")," - The API key issued by Immersve"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"x-api-secret")," - The API secret issued by Immersve")),(0,i.kt)("p",null,"Target account:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"x-account-id")," - The account ID targeted by the operation. This can be omitted if the target is the root account (such as when creating an account for example)")),(0,i.kt)("p",null,"The caller must have the correct permissions over this account to perform the requested operation."),(0,i.kt)("h2",{id:"siwe-authentication"},"SIWE Authentication"),(0,i.kt)("p",null,"The use of web3-native authentication mechanisms within the context of card issuance means that the same level of protection to a user's funds in self-custodial wallets is applied to their activities as a cardholder."),(0,i.kt)("p",null,"Accounts are identified by way of blockchain addresses. Proof of ownership of an address is based upon a process of authentication by way of verification of ",(0,i.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-4361"},"EIP-4361")," challenges signed by the private key underlying an address. Upon successful authentication, Immersve will issue an access token for subsequent use in interactions with the Immersve API."),(0,i.kt)("p",null,"Subsequent requests for protected resources from the Immersve API may be authenticated by supplying the access token in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header."),(0,i.kt)("h3",{id:"login-flow"},"Login Flow"),(0,i.kt)(s.G,{chart:"sequenceDiagram\n    participant W as Web3 Wallet\n    participant C as API Client\n    participant I as Immersve\n    C->>+I: Generate challenge\n    I--\x3e>-C: Challenge\n    C->>W: Request to sign a message\n    W--\x3e>C: Signature\n    C->>+I: Send challenge + signature\n    I--\x3e>-C: Return access token\n\t  note over C: Access token will be used for subsequent requests for protected resources from the Immersve API",mdxType:"Mermaid"}),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"/api-reference/generate-challenge"},"Generate a challenge"),". The response is an ",(0,i.kt)("a",{parentName:"li",href:"https://eips.ethereum.org/EIPS/eip-4361"},"EIP-4361")," message in plain text to be signed by the wallet.")),(0,i.kt)("p",null,"When generating a challenge, authorization scopes must be passed. These scopes are presented to the user when signing the challenge message and are used to determine the level of access the user is granting to the application. The following scopes are available:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"full-access")," - Have full access to all your Immersve resources"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"full-access:partner")," - Have full access to all resources within your {partnerName} Immersve Account"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cardholder-partner")," - Manage cards within your {partnerName} Immersve account")),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"```\napp.immersve.com wants you to sign in with your Ethereum account:\n0xA3058369d6A481B1ff08F62B352409c3D709De9b\n\nSign in with Ethereum to the app. This request will not trigger a blockchain transaction or cost any gas fees.\n\nURI: https://app.immersve.com\nVersion: 1\nChain ID: 1\nNonce: 2hFm7TDbZmerUgnrJ\nIssued At: 2022-08-11T22:29:48.244Z\n```\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Invoke the wallet's message signing capability to get a signature for the given challenge message. The specific nature of the invocation of the message signing function is specific to the particular wallet in use."),(0,i.kt)("p",{parentName:"li"},"For a quick start, Metamask users can sign the challenge message using this ",(0,i.kt)("a",{parentName:"p",href:"https://codepen.io/imsv/full/zYMpExJ"},"CodePen"),". Alternatively, use this Node.js script to create a wallet and sign the challenge."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Signing Script"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"const ethers = require('ethers');\nconst axios = require('axios');\n\nconst baseUrl = 'https://api.immersve.com';\nconst log = (...data) => {\n  console.log.apply(null, data);\n}\n\n// Create a wallet to sign the message with\nconst privateKey = ''; //TODO: Set Private key here\nconst walletAddress = ''; //TODO: Set wallet address here\nconst chainId = 137; //Chain ID Reference: https://chainlist.org/\n\nif (!privateKey || privateKey.length === 0) {\n  console.error('WALLET_PRIVATE_KEY missing');\n  process.exit(1);\n}\nif (!walletAddress || walletAddress.length === 0) {\n  console.error('WALLET_ADDRESS missing');\n  process.exit(1);\n}\n\nconst wallet = new ethers.Wallet(privateKey);\nconst clientInstance = axios.create({ baseURL: baseUrl });\n\nconst signIn = async () => {\n  const getSignInChallenge = await clientInstance.post('/siwe/generate-challenge', {\n    walletAddress,\n    chainId,\n  });\n  const challenge = getSignInChallenge.data;\n  const signature = await wallet.signMessage(challenge);\n  const output = { message: challenge, signature: signature };\n  log(JSON.stringify(output));\n}\n\nsignIn();\n")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/api-reference/login"},"Submit the signed challenge along with the signature")," to get the access token.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The access token should be used for subsequent requests for protected resources from the Immersve API by supplying it in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header."))))}h.isMDXComponent=!0}}]);