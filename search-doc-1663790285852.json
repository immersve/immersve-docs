[{"title":"Currency Convert","type":0,"sectionRef":"#","url":"api-reference/currency-convert","content":"","keywords":""},{"title":"Models​","type":1,"pageTitle":"Currency Convert","url":"api-reference/currency-convert#models","content":"Currency Conversion "},{"title":"Operations​","type":1,"pageTitle":"Currency Convert","url":"api-reference/currency-convert#operations","content":"Convert a source currency to a target currency using Mastercard rates GET /api/currency/convert?currency={sourceCurrency}&amp;targetCurrency={targetCurrency}&amp;amount={amountToConvert}&amp;fee={extraFee} curl https://api.immersve.com/api/currency/convert?currency=NZD&amp;targetCurrency=USD&amp;amount=1000 \\ -H &quot;Authorization: Bearer $IMMERSVE_JWT_TOKEN&quot;  PARAMETERS: Field\tType\tRequired\tDescriptioncurrency\tString\tX\tThe currency alpha code to convert from amount\tNumber\tX\tThe amount of currency to convert to destination currency targetCurrency\tString The target currency alpha code for the conversion. Defaults to USD fee\tNumber Optional fee added on top of the conversion. Defaults to 0 RESPONSE: Schema: Currency Conversion EXAMPLE RESPONSE PAYLOAD: { &quot;currency&quot;: &quot;NZD&quot;, &quot;convertedCurrency&quot;: &quot;USD&quot;, &quot;amount&quot;: 1000, &quot;convertedAmount&quot;: 696.2285, &quot;rate&quot;: 0.6962285 }  "},{"title":"Getting Started","type":0,"sectionRef":"#","url":"","content":"","keywords":""},{"title":"What you'll need​","type":1,"pageTitle":"Getting Started","url":"#what-youll-need","content":"Node.js version 16.14 or above: When installing Node.js, you are recommended to check all checkboxes related to dependencies. "},{"title":"Generate a new site​","type":1,"pageTitle":"Getting Started","url":"#generate-a-new-site","content":"Generate a new Docusaurus site using the classic template. The classic template will automatically be added to your project after you run the command: npm init docusaurus@latest my-website classic  You can type this command into Command Prompt, Powershell, Terminal, or any other integrated terminal of your code editor. The command also installs all necessary dependencies you need to run Docusaurus. "},{"title":"Start your site​","type":1,"pageTitle":"Getting Started","url":"#start-your-site","content":"Run the development server: cd my-website npm run start  The cd command changes the directory you're working with. In order to work with your newly created Docusaurus site, you'll need to navigate the terminal there. The npm run start command builds your website locally and serves it through a development server, ready for you to view at http://localhost:3000/. Open docs/intro.md (this page) and edit some lines: the site reloads automatically and displays your changes. "},{"title":"Currency List","type":0,"sectionRef":"#","url":"api-reference/currency-list","content":"","keywords":""},{"title":"Models​","type":1,"pageTitle":"Currency List","url":"api-reference/currency-list#models","content":"Currency "},{"title":"Operations​","type":1,"pageTitle":"Currency List","url":"api-reference/currency-list#operations","content":"Get list of supported currencies by Immersve GET /api/currencies curl https://api.immersve.com/api/currencies \\ -H &quot;Authorization: Bearer $IMMERSVE_JWT_TOKEN&quot;  RESPONSE: Schema: Array&lt;Currency&gt; EXAMPLE RESPONSE PAYLOAD: [ { &quot;symbol&quot;: &quot;KYD&quot;, &quot;label&quot;: &quot;CAYMAN ISLAND DOLLAR&quot; },{ &quot;symbol&quot;: &quot;JPY&quot;, &quot;label&quot;: &quot;JAPANESE YEN&quot; },{ &quot;symbol&quot;: &quot;NZD&quot;, &quot;label&quot;: &quot;NEW ZEALAND DOLLAR&quot; },{ &quot;symbol&quot;: &quot;USD&quot;, &quot;label&quot;: &quot;UNITED STATES DOLLAR&quot; } ]  "},{"title":"Authentication","type":0,"sectionRef":"#","url":"guides/authentication","content":"Authentication Use your web3 wallet to authenticate with Immersve","keywords":""},{"title":"Congratulations!","type":0,"sectionRef":"#","url":"guides/congratulations","content":"","keywords":""},{"title":"What's next?​","type":1,"pageTitle":"Congratulations!","url":"guides/congratulations#whats-next","content":"Read the official documentation.Add a custom Design and LayoutAdd a search barFind inspirations in the Docusaurus showcaseGet involved in the Docusaurus Community "},{"title":"Create a Document","type":0,"sectionRef":"#","url":"guides/create-a-document","content":"","keywords":""},{"title":"Create your first Doc​","type":1,"pageTitle":"Create a Document","url":"guides/create-a-document#create-your-first-doc","content":"Create a Markdown file at docs/hello.md: docs/hello.md # Hello This is my **first Docusaurus document**!  A new document is now available at http://localhost:3000/docs/hello. "},{"title":"Configure the Sidebar​","type":1,"pageTitle":"Create a Document","url":"guides/create-a-document#configure-the-sidebar","content":"Docusaurus automatically creates a sidebar from the docs folder. Add metadata to customize the sidebar label and position: docs/hello.md --- sidebar_label: 'Hi!' sidebar_position: 3 --- # Hello This is my **first Docusaurus document**!  It is also possible to create your sidebar explicitly in sidebars.js: sidebars.js module.exports = { tutorialSidebar: [ { type: 'category', label: 'Tutorial', items: ['hello'], }, ], };  "},{"title":"Markdown Features","type":0,"sectionRef":"#","url":"guides/markdown-features","content":"","keywords":""},{"title":"Front Matter​","type":1,"pageTitle":"Markdown Features","url":"guides/markdown-features#front-matter","content":"Markdown documents have metadata at the top called Front Matter: my-doc.md --- id: my-doc-id title: My document title description: My document description slug: /my-custom-url --- ## Markdown heading Markdown text with [links](./hello.md)  "},{"title":"Links​","type":1,"pageTitle":"Markdown Features","url":"guides/markdown-features#links","content":"Regular Markdown links are supported, using url paths or relative file paths. Let's see how to [Create a page](/create-a-page).  Let's see how to [Create a page](./create-a-page.md).  Result: Let's see how to Create a page. "},{"title":"Images​","type":1,"pageTitle":"Markdown Features","url":"guides/markdown-features#images","content":"Regular Markdown images are supported. You can use absolute paths to reference images in the static directory (static/img/docusaurus.png): ![Docusaurus logo](/img/docusaurus.png)  "},{"title":"Code Blocks​","type":1,"pageTitle":"Markdown Features","url":"guides/markdown-features#code-blocks","content":"Markdown code blocks are supported with Syntax highlighting. ```jsx title=&quot;src/components/HelloDocusaurus.js&quot; function HelloDocusaurus() { return ( &lt;h1&gt;Hello, Docusaurus!&lt;/h1&gt; ) } ```  src/components/HelloDocusaurus.js function HelloDocusaurus() { return &lt;h1&gt;Hello, Docusaurus!&lt;/h1&gt;; }  "},{"title":"Admonitions​","type":1,"pageTitle":"Markdown Features","url":"guides/markdown-features#admonitions","content":"Docusaurus has a special syntax to create admonitions and callouts: :::tip My tip Use this awesome feature option ::: :::danger Take care This action is dangerous :::  My tip Use this awesome feature option Take care This action is dangerous "},{"title":"MDX and React Components​","type":1,"pageTitle":"Markdown Features","url":"guides/markdown-features#mdx-and-react-components","content":"MDX can make your documentation more interactive and allows using any React components inside Markdown: export const Highlight = ({children, color}) =&gt; ( &lt;span style={{ backgroundColor: color, borderRadius: '20px', color: '#fff', padding: '10px', cursor: 'pointer', }} onClick={() =&gt; { alert(`You clicked the color ${color} with label ${children}`) }}&gt; {children} &lt;/span&gt; ); This is &lt;Highlight color=&quot;#25c2a0&quot;&gt;Docusaurus green&lt;/Highlight&gt; ! This is &lt;Highlight color=&quot;#1877F2&quot;&gt;Facebook blue&lt;/Highlight&gt; !  This is Docusaurus green ! This is Facebook blue ! "},{"title":"Create a Page","type":0,"sectionRef":"#","url":"guides/create-a-page","content":"","keywords":""},{"title":"Create your first React Page​","type":1,"pageTitle":"Create a Page","url":"guides/create-a-page#create-your-first-react-page","content":"Create a file at src/pages/my-react-page.js: src/pages/my-react-page.js import React from 'react'; import Layout from '@theme/Layout'; export default function MyReactPage() { return ( &lt;Layout&gt; &lt;h1&gt;My React page&lt;/h1&gt; &lt;p&gt;This is a React page&lt;/p&gt; &lt;/Layout&gt; ); }  A new page is now available at http://localhost:3000/my-react-page. "},{"title":"Create your first Markdown Page​","type":1,"pageTitle":"Create a Page","url":"guides/create-a-page#create-your-first-markdown-page","content":"Create a file at src/pages/my-markdown-page.md: src/pages/my-markdown-page.md # My Markdown page This is a Markdown page  A new page is now available at http://localhost:3000/my-markdown-page. "},{"title":"CurrencyConversion","type":0,"sectionRef":"#","url":"models/currency-conversion-model","content":"","keywords":""},{"title":"Model​","type":1,"pageTitle":"CurrencyConversion","url":"models/currency-conversion-model#model","content":"Field\tType\tDescriptioncurrency\tString\tThe currency to convert from targetCurrency\tString\tThe target currency for the conversion convertedCurrency\tString\tThe currency converted to amount\tNumber\tThe amount of currency to convert to destination currency convertedAmount\tNumber\tThe resulting amount of the conversion from currency into convertedCurrency rate\tNumber\tThe conversion rate from currency to convertedCurrency "},{"title":"Currency","type":0,"sectionRef":"#","url":"models/currency-model","content":"","keywords":""},{"title":"Model​","type":1,"pageTitle":"Currency","url":"models/currency-model#model","content":"Field\tType\tDescriptionsymbol\tString\tThe Alpha code for the currency. label\tString\tThe full name of the currency. "},{"title":"MetaMask Integration","type":0,"sectionRef":"#","url":"guides/metamask-integration","content":"","keywords":""},{"title":"Notes​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#notes","content":"User funding/login wallet (must be a USDC polygon wallet) User Flows "},{"title":"Login Flow​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#login-flow","content":"sequenceDiagram autonumber actor C as Customer participant M as Metamask participant I as Immersve C-&gt;&gt;M: Initiate login M-&gt;&gt;+I: Get nonce I--&gt;&gt;-M: Randomly generated nonce M-&gt;&gt;C: Request approval to sign an EIP-4361 message with nonce C--&gt;&gt;M: Approve Sign Request M-&gt;&gt;+I: Send signed EIP-4361 message I--&gt;&gt;-M: Return JWT Token note over M: JWT Token will be used for the following requests to Immersve API Request a nonce GET /api/siwe/nonce will return a random nonce value as a plain text that will also be stored in the session Create SIWE message using the nonce Submit a signed challenge with the wallet information POST /api/siwe/login Request: { &quot;message&quot;: &quot;app.sb1.lol wants you to sign in with your Ethereum account:\\n0xA3058369d6A481B1ff08F62B352409c3D709De9b\\n\\nSign in with Ethereum to the app. This request will not trigger a blockchain transaction or cost any gas fees.\\n\\nURI: https://app.sb1.lol\\nVersion: 1\\nChain ID: 1\\nNonce: 2hFm7TDbZmerUgnrJ\\nIssued At: 2022-08-11T22:29:48.244Z&quot;, &quot;signature&quot;: &quot;0xbf...&quot; } Response: { &quot;user&quot;: { &quot;id&quot;: string, // user id in Immersve &quot;walletAddress&quot;: string }, &quot;token&quot;: string //JWT token&gt; }  "},{"title":"Payment Flow​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#payment-flow","content":"sequenceDiagram autonumber participant C as Customer participant M as Metamask participant I as Immersve participant B as Blockchain C-&gt;&gt;M: Start Pay Metamask Plugin C-&gt;&gt;M: Set Amount and Currency M-&gt;&gt;I: Get Currency Conversion I--&gt;&gt;M: Return Currency Conversion in USDC C-&gt;&gt;M: Create Card Request M-&gt;&gt;I: Pre Card Generation Validation I--&gt;&gt;M: Pre Card Generation Validation Results M--&gt;&gt;C: Request Blockchain Transaction Approval alt KYC required M--&gt;&gt;C: Present QR Code to complete KYC else AML Soft Fail M--&gt;&gt;C: Present QR Code to complete AML else AML Hard Fail M--&gt;&gt;C: Show an error, this wallet cannot be used end C-&gt;&gt;M: Approve Transaction Request M-&gt;&gt;B: Submit Transaction B--&gt;&gt;M: Transaction Submitted M-&gt;&gt;I: Create Card Request activate I I-&gt;&gt;B: Check for Transaction to be Confirmed B--&gt;&gt;I: Transaction Confirmation I--&gt;&gt;I: Create VCC I--&gt;&gt;M: Customer Token deactivate I note right of M: Following record will have a different Authorization to maintain PCI compliance M-&gt;&gt;I: Retrieve Card Details I--&gt;&gt;M: Secure Card Details M--&gt;&gt;C: Present Card Details "},{"title":"Authentication​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#authentication","content":"To call Immersve API Authenticate user web3 wallet against Immersve dApp with a sign challenge After the challenge is signed, the client will receive a JWT token signed by Immersve. This token will represent the user credentials on Immesrve backend To fetch card detailsA token will be issued to MetaMask to call card details API "},{"title":"Generating Card​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#generating-card","content":"Get list of currencies that we support for currency conversion call. Immersve should put cache control on thisUSDC to currency conversion (including estimated gas fee), this is estimate only: GET /currency/convert?target={targetCurrencySymbol}¤cy={sourceCurrencySymbol}&amp;amount={amountToConvert} Response: { &quot;sourceCurrency&quot;: &quot;NZD&quot;, &quot;targetCurrency&quot;: &quot;USDC&quot;, &quot;sourceAmount&quot;: 500, &quot;targetAmount&quot;: 320.22, &quot;expiresIn&quot;: &quot;2022-01-01 00000 UTC&quot;, //TODO: check currency conversion API from Mastercard &quot;rate&quot;: 1.5, &quot;fees&quot;: [{ &quot;type&quot;: &quot;gas&quot;, &quot;amount&quot;: 2.50, &quot;currency&quot;: &quot;USDC&quot; }, { &quot;type&quot;: &quot;conversion_fee&quot;, &quot;amount&quot;: 5, &quot;currency&quot;: &quot;NZD&quot; } ] }  Check if new Card generation is allowed Sometimes, the creation of a new card won’t be allowed: KYC is requiredAML hard reject (user wallets is black listed)AML soft reject (user needs to provide more details on the source of funds) POST /card/generation-check Body: { &quot;chainID&quot;: 137, // for now, just the Polygon network &quot;address&quot;: &quot;0x3131232&quot;, // actual wallet where the user will pay from &quot;amount&quot;: { &quot;total&quot;: 320.22, // amount in USDC &quot;buffer&quot;: 0.1, // (optional) extra buffer to be sure that the transaction will go through &quot;currency&quot;: &quot;USDC&quot;, // we will always use USDC, but we might want to use something else in the future, so this could be optional }, &quot;reference&quot;: &quot;0asd3as21d&quot; //TODO: check if we should send a reference back }  200 - Response Successful User is allowed to generate a new card. Client should be able to request a transaction from the user wallet to Immersve wallet { &quot;status&quot;: &quot;authorized&quot;, &quot;targetWallet&quot;: &quot;0x031231&quot;, // Immersve wallet. This can be useful if we need to change the wallet in the future &quot;amount&quot;: { // authorized amount, anything higher than this will be rejected later (except for the buffer) &quot;total&quot;: 320.22, // amount in USDC &quot;buffer&quot;: 0.1, // (optional) extra buffer to be sure that the transaction will go through &quot;currency&quot;: &quot;USDC&quot;, // we will always use USDC, but we might want to use something else in the future, so this could be optional } }  401 - Unauthorized User is not logged in, or the authentication token is expired. Will need to re-login Response: { &quot;status&quot;: &quot;unauthorized&quot;, &quot;reason&quot;: &quot;NOT_LOGGED_IN&quot;, &quot;actionUrl&quot;: &quot;https://immersve.com/user/web3/login&quot; //TODO }  403 - Forbidden operation //TODO: is 403 the right status code? User needs KYC When the user reaches a certain amount spent in the platform, Immersve will require them to provide some identification information to comply with regulatory entities Response: { &quot;status&quot;: &quot;error&quot;, &quot;reason&quot;: &quot;KYC_REQUIRED&quot;, &quot;actionUrl&quot;: &quot;https://immersve.com/kyc/start?userId={immersve-userId}&quot; //TODO }  AML Checks Failed Immersve AML Provider found that the funding wallet might not comply with AML and can’t check the origin of funds for the provided wallet. User will need to go through AML process to validate the source of the funds on the wallet TODO: define scenarios for hard and soft AML blocks Response: { &quot;status&quot;: &quot;error&quot;, &quot;reason&quot;: &quot;AML_CHECK_FAILED&quot;, //TODO: do we want to reveal this &quot;actionUrl&quot;: &quot;https://immersve.com/aml/start?userId={immersve-userId}&amp;wallet={fundingWallet}&quot; //TODO: anything we can do here? }  Generate new Card endpoint POST /card/ Body: { &quot;source&quot;: &quot;MetaMask&quot;, //MetaMask needs to ensure this is correct as this will be used to identify transactions triggered from MetaMask &quot;type&quot;: &quot;vcc&quot;, &quot;amount&quot;: { &quot;total&quot;: 320.22, // amount in USDC &quot;buffer&quot;: 0.1, // (optional) extra buffer to be sure that the transaction will go through &quot;currency&quot;: &quot;USDC&quot;, // we will always use USDC, but we might want to use something else in the future, so this could be optional }, &quot;transactionHash&quot;: &quot;TODO: asdf&quot;, //for Immersve to check fund transfer on chain &quot;chainID&quot;: 123, &quot;returnSurplus&quot;: true, //indicate whether the suplus fund will be returned to the card holder }  Note: Not part of MVP, but going forward we may add a wallet address as optional parameter in case wallet used to login is different from funding wallet. TODO, make the design flexible Response: 200 - Successful card creation { &quot;cardToken&quot;: &quot;xyz&quot;, //the token used to fetch card details &quot;expiry&quot;: &quot;2022-01-01 1111111UTC&quot; //if a value that is earlier than the card expiry date on the card details, this value is when the card will actually expire instead of the expiry date on the card details }  401 - Unauthorized User is not logged in, or the authentication token is expired. Will need to re-login Response: { &quot;status&quot;: &quot;unauthorized&quot;, &quot;reason&quot;: &quot;NOT_LOGGED_IN&quot;, &quot;actionUrl&quot;: &quot;https://immersve.com/user/web3/login&quot; //TODO }  403 - Forbidden operation //TODO: is 403 the right status code? User needs KYC When the user reaches a certain amount spent in the platform, Immersve will require them to provide some identification information to comply with regulatory entities Response: { &quot;status&quot;: &quot;error&quot;, &quot;reason&quot;: &quot;KYC_REQUIRED&quot;, &quot;actionUrl&quot;: &quot;https://immersve.com/kyc/start?userId={immersve-userId}&quot; //TODO }  AML Checks Failed Immersve AML Provider found that the funding wallet might not comply with AML and can’t check the origin of funds for the provided wallet. User will need to go through AML process to validate the source of the funds on the wallet TODO: define scenarios for hard and soft AML blocks Response: { &quot;status&quot;: &quot;error&quot;, &quot;reason&quot;: &quot;AML_CHECK_FAILED&quot;, //TODO: do we want to reveal this &quot;actionUrl&quot;: &quot;https://immersve.com/aml/start?userId={immersve-userId}&amp;wallet={fundingWallet}&quot; //TODO: anything we can do here? }  "},{"title":"Getting Card Secure Details​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#getting-card-secure-details","content":"Get external.immersve.com/cards/details //TODO: decide URL For the purpose of filling in ecom payment page. Response { &quot;cardNumber&quot;: &quot;4111111111111111&quot;, &quot;cvv2&quot;: &quot;123&quot;, &quot;expiry&quot;: &quot;202706&quot;, &quot;name&quot;: &quot;Immersve Mastercard&quot; }  "},{"title":"Cancel card​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#cancel-card","content":"TODO "},{"title":"Potential APIs​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#potential-apis","content":"refresh tokens API "},{"title":"TODO:​","type":1,"pageTitle":"MetaMask Integration","url":"guides/metamask-integration#todo","content":"assumptions Currency conversion displays is estimation onlyallow anyone to transfer fund to Immersve wallet (what if there are funds that are not legit fund for generating cards?) KYC/AML flows Edge cases around currency conversions Book security review with Marco AuthenticationSecure way to share Immersve wallet address with MetaMask Do we allow unintended deposit to Immersve wallet, for example a user trying to deposit an amount larger than what’s allowed without KYCa hacker decided to deposit say 1b into Immersve wallet to do cases on surplus/buffer of fund transfer to Immersve wallet (default value for MVP?) how do we handle the transfer back to the user say when the amount of surplus is less than the gas fee that is required for transferwe need to keep track of those transfers and records and running totals timing requirements on getting card details, 1 or 2 calls to E6 to get card token currency conversion lock-in mechanism, or would the currency displayed just indication only (with disclaimer) What should happen in the case of timeout? "}]